<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>{{TITLE}}1</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Leaflet -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-gpx/2.1.2/gpx.min.js"></script>

<style>
body {
  font-family: sans-serif;
  margin: 0;
  padding: 0;
  line-height: 1.7;
}
header {
  background: #000;
  color: #fff;
  padding: 20px;
  text-align: center;
}
#map {
  width: 100%;
  height: 350px;
}
.gallery {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
  gap: 10px;
  padding: 10px;
}
.gallery img {
  width: 100%;
  border-radius: 6px;
}
.section {
  padding: 20px;
}
h2 {
  border-left: 5px solid #0078ff;
  padding-left: 10px;
}
</style>
</head>

<body>

<header>
  <h1>{{TITLE}}</h1>
  <p>{{DATE}} / 距離：<span id="dist">{{DISTANCE}}</span>km / 
     獲得標高：<span id="elev">{{ELEVATION}}</span>m</p>
</header>

<div id="map"></div>

<div class="section">
  <h2>ルート概要</h2>
  <p>{{DESCRIPTION}}</p>
</div>

<div class="section">
  <h2>写真ギャラリー</h2>
  <div class="gallery">
    {{GALLERY}}
  </div>
</div>

<div class="section">
  <h2>補給ポイント</h2>
  <ul>
    {{FOOD}}
  </ul>
</div>

<div class="section">
  <h2>おすすめ装備</h2>
  <ul>
    <li><a href="{{AFFILIATE1}}">ライト（Amazon）</a></li>
    <li><a href="{{AFFILIATE2}}">補給食（Amazon）</a></li>
    <li><a href="{{AFFILIATE3}}">タイヤ（Amazon）</a></li>
  </ul>
</div>

<script>
// ① map を作成
var map = L.map("map").setView([34.6, 135.5], 12);

// ② タイルレイヤー
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
  maxZoom: 19,
  attribution: "© OpenStreetMap contributors"
}).addTo(map);

// ③ GPX 読み込み
var gpx = new L.GPX("2025-12-31.gpx", {
  async: true,
  polyline_options: {
    color: "red",
    weight: 4,
    opacity: 0.8
  }
})
.on("loaded", function(e) {
  map.fitBounds(e.target.getBounds());

  // 距離・標高を取得
  var distance = (e.target.get_distance() / 1000).toFixed(1); // km
  var elevation = Math.round(e.target.get_elevation_gain());  // m

  // HTML に反映（body を書き換えない）
  document.getElementById("dist").innerText = distance;
  document.getElementById("elev").innerText = elevation;
})
.addTo(map);
</script>

</body>
</html>
